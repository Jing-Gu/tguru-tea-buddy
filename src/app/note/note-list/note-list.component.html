<ion-header [translucent]="true" mode="md">
  <ion-toolbar>
    <ion-title>Carnet de notes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- TODO: add tabs for notes and favorites -->
  <div class="h-full overflow-y-auto">
    @if(notes$ | async; as notes) {
      @if (notes.length > 0) {
        <ion-list>
          <ion-item-sliding *ngFor="let note of notes">
            <ion-item button routerLink="{{note.id}}" mode="ios">
              <ion-label>
                <p class="!text-charcoal capitalize">{{ note.title || "Sans titre" }}</p>
                <p class="line-clamp-2">{{ note.content }}</p>
              </ion-label>
            </ion-item>
            <ion-item-options side="end">
              <ion-item-option color="danger" (click)="deleteNote(note.id)">
                <ion-icon slot="icon-only" name="trash" color="light" />
              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </ion-list>
      } @else {
        <ion-icon name="file-tray-outline" color="primary" />
      }
    } 
  </div>
</ion-content>


@if(noteForm) {
  <form [formGroup]="noteForm">
    <ion-modal [isOpen]="isModalOpen">
      <ng-template>
        <ion-header class="ion-no-border">
          <ion-toolbar>
            <ion-buttons slot="start">
              <ion-button (click)="closeModal()">
                <ion-icon name="chevron-back-outline" />
              </ion-button>
            </ion-buttons>
            <ion-buttons slot="end">
              <ion-button (click)="toggleBookmark()" [disabled]="!noteForm.valid" color="primary">
                <ion-icon [name]="pinned ? 'star' : 'star-outline'" />
              </ion-button>
              <ion-button (click)="submitNote()" [disabled]="!noteForm.valid" color="primary">
                <ion-icon name="save-outline" />
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content class="ion-padding">
          <ion-textarea placeholder="Titre" autoGrow="true" class="note-title" formControlName="title"></ion-textarea>
          <ion-textarea placeholder="Commencez ici votre idÃ©e..." autoGrow="true" formControlName="content"></ion-textarea>
        </ion-content>
    </ng-template>
    </ion-modal>
  </form>
}


<ion-fab vertical="bottom" horizontal="end" slot="fixed">
  <ion-fab-button (click)="addNewNote()" color="tertiary">
    <ion-icon name="create-outline" />
  </ion-fab-button>
</ion-fab>